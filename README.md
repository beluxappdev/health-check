# Health Check Framework

## Project Introduction

The Health Check Framework is a set of PowerShell scripts that assess the health
of Azure resources. The framework is designed to be extensible and can be used
to assess many Azure service.

## Supported services

| Service | Status   | Resources                 | Documentation link              | Owners                |
| ------- | -------- | ------------------------- | ------------------------------- | --------------------- |
| AKS     | Complete | • Cluster<br>• Node pools | [Documentation](AKS/README.md)  | @Nicwalle             |
| APIM    | WIP      |                           | [Documentation](APIM/README.md) |                       |
| SQL     | WIP      | • Server<br>• Database    | [Documentation](SQL/README.md)  | @Nicwalle, @noyasarko |

## Getting started

### Prerequisites

- PowerShell Core 7+
- Azure CLI
- `account` extension installed on Azure CLI: `az extension add --name account`

### Permissions

In order to complete the assessment, the user/service principal should be
`Reader` on all the subscriptions you want to assess.

### Execution

```powershell
# Optionally specify the output path and the CSV Delimiter as argument
.\StartAssessment.ps1 #-OutPath "C:\MyPath" -csvDelimiter ","
```

### Parameters

| Parameter    | Required                 | Default Value                         | Description                                                                                                                                                                                                                                                                         |
| ------------ | ------------------------ | ------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| OutPath      | No                       | `out/Assessment_YYYY-MM-DD_HH-mm-ss/` | The output path where the assessment results will be saved.                                                                                                                                                                                                                         |
| csvDelimiter | No                       | `,`                                   | The delimiter to be used in the CSV file generated by the assessment script.                                                                                                                                                                                                        |
| AuthType     | No                       | `user`                                | The authentication type to be used. <br> • `user`: prompts the user to authenticate <br> • `sp`: leverage service principal authentication. Requires ClientId, ClientSecret and TenantID <br> • `none`: will not re-authenticate and will leverage the current user of the terminal |
| ClientId     | Only if AuthType is `sp` |                                       | The client ID for service principal authentication. Required if AuthType is `sp`                                                                                                                                                                                                    |
| ClientSecret | Only if AuthType is `sp` |                                       | The client secret for service principal authentication.                                                                                                                                                                                                                             |
| TenantId     | Only if AuthType is `sp` |                                       | The tenant ID for service principal authentication.                                                                                                                                                                                                                                 |
| Services     | No                       | `all`                                 | A comma-separated list of services to check. Currently supported services are:<br> • `aks`<br> • `apim` <br> • `SQL`                                                                                                                                                                |

### Output

Each execution of the assessment will produce the following files in the
`-OutPath` folder (defaults to `out/Assessment_YYYY-MM-DD_HH-mm-ss/` if not
specified):

- `<SERVICE>_assess_YYYY-MM-DD_HH-mm-ss.csv` - CSV Results of the assessment
- `<SERVICE>_raw_YYYY-MM-DD_HH-mm-ss.json` - Raw JSON of the analyzed resources
- `log_YYYY-MM-DD_HH-mm-ss.txt` - Transcript of the PowerShell execution

## Contributing

The Health Check Framework is an open-source project and welcomes contributions.
To contribute, please follow the [Contribution Guidelines](CONTRIBUTING.md). It
defines the requirements to create new checks for other services or improve the
existing ones.
